<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Management - Brutally Honest</title>
    
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dynamic-portal.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="dynamic-portal.js"></script>
    <script src="notifications.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-title">
                <img src="logo.svg" alt="Brutally Honest Logo" class="logo">
                <h1>Brutally Honest</h1>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="nav-menu">
                <a href="/" class="nav-link">
                    <i data-lucide="home" class="nav-icon"></i>
                    Home
                </a>
                <a href="/documents" class="nav-link">
                    <i data-lucide="file-text" class="nav-icon"></i>
                    Documents
                </a>
                <a href="/profiles" class="nav-link active">
                    <i data-lucide="users" class="nav-icon"></i>
                    Profiles
                </a>
                <a href="/validation" class="nav-link">
                    <i data-lucide="check-circle" class="nav-icon"></i>
                    Validation
                </a>
                <a href="#" class="nav-link" onclick="showDocumentation()">
                    <i data-lucide="book-open" class="nav-icon"></i>
                    Documentation
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">

            <!-- Profile Type Selection -->
            <div class="section">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="tab-button active" onclick="switchProfileType('clients')" id="tab-clients">
                        <i data-lucide="briefcase" style="width: 16px; height: 16px;"></i>
                        Clients
                    </button>
                    <button class="tab-button" onclick="switchProfileType('brands')" id="tab-brands">
                        <i data-lucide="tag" style="width: 16px; height: 16px;"></i>
                        Brands
                    </button>
                    <button class="tab-button" onclick="switchProfileType('persons')" id="tab-persons">
                        <i data-lucide="user" style="width: 16px; height: 16px;"></i>
                        Persons
                    </button>
                </div>
            </div>

            <!-- Create Profile Section -->
            <div class="section">
                <h2 id="create-profile-title">Create Client Profile</h2>
                <form id="create-profile-form" onsubmit="createProfile(event)">
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Name *</label>
                            <input type="text" id="profile-name" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <div id="client-fields">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Type *</label>
                            <select id="profile-type" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="individual">Individual</option>
                                <option value="company">Company</option>
                                <option value="brand">Brand</option>
                            </select>
                        </div>
                        
                        <div id="person-fields" style="display: none;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Role</label>
                            <input type="text" id="profile-role" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <div id="person-company-field" style="display: none;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Company</label>
                            <input type="text" id="profile-company" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Description *</label>
                            <textarea id="profile-description" required rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                        </div>
                        
                        <div id="brand-values-field" style="display: none;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Values (comma-separated)</label>
                            <input type="text" id="profile-values" placeholder="e.g., quality, innovation, sustainability" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Tags (comma-separated)</label>
                            <input type="text" id="profile-tags" placeholder="e.g., retail, DIY, europe" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
                            Create Profile
                        </button>
                    </div>
                </form>
            </div>

            <!-- Profiles List -->
            <div class="section">
                <h2 id="profiles-list-title">Client Profiles</h2>
                <div id="profiles-list" style="display: grid; gap: 15px;">
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <i data-lucide="users" style="width: 48px; height: 48px; margin-bottom: 15px;"></i>
                        <p>No profiles yet. Create your first profile above.</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentProfileType = 'clients';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadProfiles();
        });

        function switchProfileType(type) {
            currentProfileType = type;
            
            // Update tabs
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${type}`).classList.add('active');
            
            // Update form fields
            const clientFields = document.getElementById('client-fields');
            const personFields = document.getElementById('person-fields');
            const personCompanyField = document.getElementById('person-company-field');
            const brandValuesField = document.getElementById('brand-values-field');
            
            clientFields.style.display = 'none';
            personFields.style.display = 'none';
            personCompanyField.style.display = 'none';
            brandValuesField.style.display = 'none';
            
            if (type === 'clients') {
                clientFields.style.display = 'block';
                document.getElementById('create-profile-title').textContent = 'Create Client Profile';
                document.getElementById('profiles-list-title').textContent = 'Client Profiles';
            } else if (type === 'brands') {
                brandValuesField.style.display = 'block';
                document.getElementById('create-profile-title').textContent = 'Create Brand Profile';
                document.getElementById('profiles-list-title').textContent = 'Brand Profiles';
            } else if (type === 'persons') {
                personFields.style.display = 'block';
                personCompanyField.style.display = 'block';
                document.getElementById('create-profile-title').textContent = 'Create Person Profile';
                document.getElementById('profiles-list-title').textContent = 'Person Profiles';
            }
            
            // Load profiles
            loadProfiles();
            
            // Reset form
            document.getElementById('create-profile-form').reset();
        }

        async function createProfile(event) {
            event.preventDefault();
            
            try {
                const name = document.getElementById('profile-name').value;
                const description = document.getElementById('profile-description').value;
                const tags = document.getElementById('profile-tags').value;
                
                let formData = new URLSearchParams();
                formData.append('name', name);
                formData.append('description', description);
                if (tags) formData.append('tags', tags);
                
                let endpoint = '';
                if (currentProfileType === 'clients') {
                    const type = document.getElementById('profile-type').value;
                    formData.append('type', type);
                    endpoint = '/profiles/clients';
                } else if (currentProfileType === 'brands') {
                    const values = document.getElementById('profile-values').value;
                    if (values) formData.append('values', values);
                    endpoint = '/profiles/brands';
                } else if (currentProfileType === 'persons') {
                    const role = document.getElementById('profile-role').value;
                    const company = document.getElementById('profile-company').value;
                    if (role) formData.append('role', role);
                    if (company) formData.append('company', company);
                    endpoint = '/profiles/persons';
                }
                
                const response = await fetch(`${API_BASE}${endpoint}?${formData.toString()}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('✅ Profile created successfully!', 'success');
                    document.getElementById('create-profile-form').reset();
                    loadProfiles();
                } else {
                    showNotification('❌ Failed to create profile', 'error');
                }
            } catch (error) {
                console.error('Error creating profile:', error);
                showNotification('❌ Error creating profile', 'error');
            }
        }

        async function loadProfiles() {
            try {
                let endpoint = '';
                if (currentProfileType === 'clients') {
                    endpoint = '/profiles/clients';
                } else if (currentProfileType === 'brands') {
                    endpoint = '/profiles/brands';
                } else if (currentProfileType === 'persons') {
                    endpoint = '/profiles/persons';
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`);
                const result = await response.json();
                
                const listEl = document.getElementById('profiles-list');
                
                if (result.success && result.profiles && result.profiles.length > 0) {
                    listEl.innerHTML = result.profiles.map(profile => `
                        <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <div>
                                    <h3 style="margin: 0 0 5px 0;">${escapeHtml(profile.name)}</h3>
                                    ${profile.type ? `<span style="display: inline-block; background: #f0f0f0; padding: 2px 8px; border-radius: 12px; font-size: 12px; color: #666;">${escapeHtml(profile.type)}</span>` : ''}
                                    ${profile.role ? `<span style="display: inline-block; background: #f0f0f0; padding: 2px 8px; border-radius: 12px; font-size: 12px; color: #666;">${escapeHtml(profile.role)}</span>` : ''}
                                </div>
                                <button onclick="deleteProfile('${profile.id}')" style="background: #ff4444; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                                    <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                                </button>
                            </div>
                            <p style="color: #666; margin: 10px 0;">${escapeHtml(profile.description)}</p>
                            ${profile.tags && profile.tags.length > 0 ? `
                                <div style="margin-top: 10px;">
                                    ${profile.tags.map(tag => `<span style="display: inline-block; background: #e7f3ff; color: #0066cc; padding: 3px 10px; border-radius: 12px; font-size: 12px; margin-right: 5px;">${escapeHtml(tag)}</span>`).join('')}
                                </div>
                            ` : ''}
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 14px; color: #666;">${profile.facts ? profile.facts.length : 0} facts</span>
                                    <button onclick="viewProfile('${profile.id}')" style="background: #000; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    lucide.createIcons();
                } else {
                    listEl.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <i data-lucide="users" style="width: 48px; height: 48px; margin-bottom: 15px;"></i>
                            <p>No profiles yet. Create your first profile above.</p>
                        </div>
                    `;
                    lucide.createIcons();
                }
            } catch (error) {
                console.error('Error loading profiles:', error);
            }
        }

        async function deleteProfile(profileId) {
            if (!confirm('Are you sure you want to delete this profile?')) return;
            
            try {
                let endpoint = '';
                if (currentProfileType === 'clients') {
                    endpoint = `/profiles/clients/${profileId}`;
                } else if (currentProfileType === 'brands') {
                    endpoint = `/profiles/brands/${profileId}`;
                } else if (currentProfileType === 'persons') {
                    endpoint = `/profiles/persons/${profileId}`;
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('✅ Profile deleted successfully', 'success');
                    loadProfiles();
                } else {
                    showNotification('❌ Failed to delete profile', 'error');
                }
            } catch (error) {
                console.error('Error deleting profile:', error);
                showNotification('❌ Error deleting profile', 'error');
            }
        }

        function viewProfile(profileId) {
            alert(`Profile details view coming soon! ID: ${profileId}`);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message, type) {
            if (typeof Notifications !== 'undefined') {
                Notifications.show(message, type);
            } else {
                alert(message);
            }
        }
    </script>

    <style>
        .tab-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .tab-button:hover {
            background: #f5f5f5;
        }
        
        .tab-button.active {
            background: #000;
            color: white;
            border-color: #000;
        }
        
        .btn-primary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #000;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: #333;
        }
    </style>
</body>
</html>

