<!-- Profile Type Selection - Centered Buttons -->
<div class="section token-buttons-section">
    <div class="token-buttons-container">
        <button type="button" class="btn token-button-active" onclick="switchProfileType('clients')" id="tab-clients">
            <i data-lucide="briefcase"></i>
            <span>Clients</span>
        </button>
        <button type="button" class="btn" onclick="switchProfileType('brands')" id="tab-brands">
            <i data-lucide="tag"></i>
            <span>Brands</span>
        </button>
        <button type="button" class="btn" onclick="switchProfileType('persons')" id="tab-persons">
            <i data-lucide="user"></i>
            <span>Persons</span>
        </button>
    </div>
</div>

<!-- Create Profile Section -->
<div class="section">
    <h2 id="create-profile-title">Create Client Profile</h2>
    <form id="create-profile-form" class="form-grid" onsubmit="createProfile(event)">
        <div class="form-group">
            <label class="form-label">Name *</label>
            <input type="text" id="profile-name" class="form-input" required>
        </div>
        
        <div id="client-fields" class="form-group">
            <label class="form-label">Type *</label>
            <select id="profile-type" class="form-input" required>
                <option value="individual">Individual</option>
                <option value="company">Company</option>
                <option value="brand">Brand</option>
            </select>
        </div>
        
        <div id="person-fields" class="form-group" style="display: none;">
            <label class="form-label">Role</label>
            <input type="text" id="profile-role" class="form-input">
        </div>
        
        <div id="person-company-field" class="form-group" style="display: none;">
            <label class="form-label">Company</label>
            <input type="text" id="profile-company" class="form-input">
        </div>
        
        <div class="form-group">
            <label class="form-label">Description *</label>
            <textarea id="profile-description" class="form-input" rows="3" required></textarea>
        </div>
        
        <div id="brand-values-field" class="form-group" style="display: none;">
            <label class="form-label">Values (comma-separated)</label>
            <input type="text" id="profile-values" class="form-input" placeholder="e.g., quality, innovation, sustainability">
        </div>
        
        <div class="form-group">
            <label class="form-label">Tags (comma-separated)</label>
            <input type="text" id="profile-tags" class="form-input" placeholder="e.g., retail, DIY, europe">
        </div>
        
        <button type="submit" class="btn btn-block">
            <i data-lucide="plus"></i>
            Create Profile
        </button>
    </form>
</div>

<!-- Profiles List -->
<div class="section">
    <h2 id="profiles-list-title">Client Profiles</h2>
    <div id="profiles-list" class="profiles-grid">
        <div class="empty-state">
            <i data-lucide="users"></i>
            <p>No profiles yet. Create your first profile above.</p>
        </div>
    </div>
</div>

<style>
    /* Form Styles */
    .form-grid {
        display: grid;
        gap: 16px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    
    .form-label {
        font-weight: 500;
        font-size: 14px;
        color: #333;
    }
    
    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        font-family: inherit;
        transition: border-color 0.2s ease;
        background: #fff;
    }
    
    .form-input:focus {
        outline: none;
        border-color: #000;
    }
    
    /* Profiles Grid */
    .profiles-grid {
        display: grid;
        gap: 16px;
    }
    
    /* Empty State */
    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 60px 20px;
        color: #999;
        width: 100%;
    }
    
    .empty-state i {
        width: 48px;
        height: 48px;
        margin-bottom: 16px;
        stroke-width: 1.5;
    }
    
    .empty-state p {
        margin: 0;
        text-align: center;
    }
    
    /* Profile Card */
    .profile-card {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
    }
    
    .profile-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }
    
    .profile-card h3 {
        margin: 0 0 6px 0;
        font-size: 16px;
        font-weight: 600;
    }
    
    .profile-card p {
        color: #666;
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.5;
    }
    
    .profile-tag {
        display: inline-block;
        background: #f0f0f0;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 12px;
        color: #666;
        margin-right: 6px;
        margin-bottom: 6px;
    }
    
    .profile-tag-blue {
        background: #e7f3ff;
        color: #0066cc;
    }
    
    .profile-card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e0e0e0;
    }
    
    .profile-facts {
        font-size: 14px;
        color: #666;
    }
</style>

<script>
    let currentProfileType = 'clients';

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
        loadProfiles();
    });

    function switchProfileType(type) {
        currentProfileType = type;
        
        // Update active button
        document.querySelectorAll('.token-buttons-container .btn').forEach(btn => {
            btn.classList.remove('token-button-active');
        });
        document.getElementById(`tab-${type}`).classList.add('token-button-active');
        
        // Show/hide fields
        const clientFields = document.getElementById('client-fields');
        const personFields = document.getElementById('person-fields');
        const personCompanyField = document.getElementById('person-company-field');
        const brandValuesField = document.getElementById('brand-values-field');
        
        clientFields.style.display = 'none';
        personFields.style.display = 'none';
        personCompanyField.style.display = 'none';
        brandValuesField.style.display = 'none';
        
        if (type === 'clients') {
            clientFields.style.display = 'flex';
            document.getElementById('create-profile-title').textContent = 'Create Client Profile';
            document.getElementById('profiles-list-title').textContent = 'Client Profiles';
        } else if (type === 'brands') {
            brandValuesField.style.display = 'flex';
            document.getElementById('create-profile-title').textContent = 'Create Brand Profile';
            document.getElementById('profiles-list-title').textContent = 'Brand Profiles';
        } else if (type === 'persons') {
            personFields.style.display = 'flex';
            personCompanyField.style.display = 'flex';
            document.getElementById('create-profile-title').textContent = 'Create Person Profile';
            document.getElementById('profiles-list-title').textContent = 'Person Profiles';
        }
        
        loadProfiles();
        document.getElementById('create-profile-form').reset();
    }

    async function createProfile(event) {
        event.preventDefault();
        
        try {
            const name = document.getElementById('profile-name').value;
            const description = document.getElementById('profile-description').value;
            const tags = document.getElementById('profile-tags').value;
            
            let formData = new URLSearchParams();
            formData.append('name', name);
            formData.append('description', description);
            if (tags) formData.append('tags', tags);
            
            let endpoint = '';
            if (currentProfileType === 'clients') {
                const type = document.getElementById('profile-type').value;
                formData.append('type', type);
                endpoint = '/profiles/clients';
            } else if (currentProfileType === 'brands') {
                const values = document.getElementById('profile-values').value;
                if (values) formData.append('values', values);
                endpoint = '/profiles/brands';
            } else if (currentProfileType === 'persons') {
                const role = document.getElementById('profile-role').value;
                const company = document.getElementById('profile-company').value;
                if (role) formData.append('role', role);
                if (company) formData.append('company', company);
                endpoint = '/profiles/persons';
            }
            
            const response = await fetch(`${API_BASE}${endpoint}?${formData.toString()}`, {
                method: 'POST'
            });
            
            const result = await response.json();
            
            if (result.success) {
                showNotification('‚úÖ Profile created successfully!', 'success');
                document.getElementById('create-profile-form').reset();
                loadProfiles();
            } else {
                showNotification('‚ùå Failed to create profile', 'error');
            }
        } catch (error) {
            console.error('Error creating profile:', error);
            showNotification('‚ùå Error creating profile', 'error');
        }
    }

    async function loadProfiles() {
        try {
            let endpoint = '/profiles/' + currentProfileType;
            
            const response = await fetch(`${API_BASE}${endpoint}`);
            const result = await response.json();
            
            const listEl = document.getElementById('profiles-list');
            
            if (result.success && result.profiles && result.profiles.length > 0) {
                listEl.innerHTML = result.profiles.map(profile => `
                    <div class="profile-card">
                        <div class="profile-card-header">
                            <div>
                                <h3>${escapeHtml(profile.name)}</h3>
                                ${profile.type ? `<span class="profile-tag">${escapeHtml(profile.type)}</span>` : ''}
                                ${profile.role ? `<span class="profile-tag">${escapeHtml(profile.role)}</span>` : ''}
                            </div>
                            <button onclick="deleteProfile('${profile.id}')" class="btn btn-danger btn-sm">
                                <i data-lucide="trash-2"></i>
                            </button>
                        </div>
                        <p>${escapeHtml(profile.description)}</p>
                        ${profile.tags && profile.tags.length > 0 ? `
                            <div>
                                ${profile.tags.map(tag => `<span class="profile-tag profile-tag-blue">${escapeHtml(tag)}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="profile-card-footer">
                            <span class="profile-facts">${profile.facts ? profile.facts.length : 0} facts</span>
                            <button onclick="viewProfile('${profile.id}')" class="btn btn-sm">
                                View Details
                            </button>
                        </div>
                    </div>
                `).join('');
                
                lucide.createIcons();
            } else {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <i data-lucide="users"></i>
                        <p>No profiles yet. Create your first profile above.</p>
                    </div>
                `;
                lucide.createIcons();
            }
        } catch (error) {
            console.error('Error loading profiles:', error);
        }
    }

    async function deleteProfile(profileId) {
        if (!confirm('Are you sure you want to delete this profile?')) return;
        
        try {
            const endpoint = `/profiles/${currentProfileType}/${profileId}`;
            
            const response = await fetch(`${API_BASE}${endpoint}`, {
                method: 'DELETE'
            });
            
            const result = await response.json();
            
            if (result.success) {
                showNotification('‚úÖ Profile deleted successfully', 'success');
                loadProfiles();
            } else {
                showNotification('‚ùå Failed to delete profile', 'error');
            }
        } catch (error) {
            console.error('Error deleting profile:', error);
            showNotification('‚ùå Error deleting profile', 'error');
        }
    }

    function viewProfile(profileId) {
        alert(`Profile details view coming soon! ID: ${profileId}`);
    }
    
    function showPageInfo() {
        showInfoModal('üë• Profile Management', `
            <h3>Profile Types</h3>
            <ul>
                <li><strong>Clients</strong> - Business clients with contact information</li>
                <li><strong>Brands</strong> - Company brands with guidelines and documents</li>
                <li><strong>Persons</strong> - Individual speakers for voice recognition</li>
            </ul>
            
            <h3>Voice Profiles</h3>
            <p>Create person profiles with voice samples to enable speaker identification in transcriptions.</p>
            
            <h3>Brand Documents</h3>
            <p>Attach documents to brand profiles to validate claims against official brand guidelines.</p>
        `);
    }
</script>
